<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Climate Dashboard Deutschland</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>

<style>
body{
  font-family:Arial,sans-serif;
  padding:30px;
  background:#f4f6f8;
}

.tabs{
  display:flex;
  gap:20px;
  margin-bottom:30px;
}

.tab-button{
  padding:10px 20px;
  cursor:pointer;
  background:#ddd;
  border:none;
  border-radius:6px;
  font-weight:bold;
}

.tab-button.active{
  background:#444;
  color:white;
}

.tab-content{
  display:none;
}

.tab-content.active{
  display:block;
}

.chart-container{
  max-width:1500px;
  height:550px;
  margin:40px auto;
  background:white;
  padding:20px;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

canvas{
  width:100% !important;
  height:100% !important;
}
</style>
</head>
<body>

<h1>Climate Dashboard Deutschland</h1>

<div class="tabs">
  <button class="tab-button active" onclick="switchTab('monthly')">Monatswerte</button>
  <button class="tab-button" onclick="switchTab('daily')">Tageshöchstwerte</button>
</div>

<!-- ================= MONATSDASHBOARD ================= -->

<div id="monthly" class="tab-content active">

<p>Monatsdashboard bleibt hier wie zuvor integriert.</p>

</div>

<!-- ================= TAGESDASHBOARD ================= -->

<div id="daily" class="tab-content">

<label>Jahr:</label>
<select id="yearSelect"></select>

<label>Zeitraum:</label>
<select id="rangeSelect">
  <option value="year">Ganzes Jahr</option>
  <option value="winter">Winter</option>
  <option value="spring">Frühling</option>
  <option value="summer">Sommer</option>
  <option value="autumn">Herbst</option>
</select>

<div class="chart-container">
  <canvas id="dailyChart"></canvas>
</div>

<div class="chart-container">
  <canvas id="dailyDeviationChart"></canvas>
</div>

</div>

<script>

function switchTab(tab){
  document.querySelectorAll(".tab-button").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
  document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add("active");
  document.getElementById(tab).classList.add("active");
}

let dailyData=[];
let dailyChart;
let dailyDeviationChart;

fetch("daily_tmax_1881_2026.json")
.then(res=>res.json())
.then(data=>{
  dailyData=data;

  const years=[...new Set(data.map(d=>d.date.substring(0,4)))];

  const yearSelect=document.getElementById("yearSelect");
  years.forEach(y=>{
    const opt=document.createElement("option");
    opt.value=y;
    opt.text=y;
    yearSelect.appendChild(opt);
  });

  yearSelect.value=years[years.length-1];
  updateDaily();
});

function updateDaily(){

  const year=document.getElementById("yearSelect").value;
  const range=document.getElementById("rangeSelect").value;

  let filtered=dailyData.filter(d=>d.date.startsWith(year));

  if(range!=="year"){
    if(range==="winter")
      filtered=filtered.filter(d=>["12","01","02"].includes(d.date.substring(5,7)));
    if(range==="spring")
      filtered=filtered.filter(d=>["03","04","05"].includes(d.date.substring(5,7)));
    if(range==="summer")
      filtered=filtered.filter(d=>["06","07","08"].includes(d.date.substring(5,7)));
    if(range==="autumn")
      filtered=filtered.filter(d=>["09","10","11"].includes(d.date.substring(5,7)));
  }

  const labels=filtered.map(d=>d.date);
  const values=filtered.map(d=>d.tmax);
  const climate=filtered.map(d=>d.climate_mean);

  const deviation=filtered.map(d=>
    parseFloat((d.tmax-d.climate_mean).toFixed(1))
  );

dailyDeviationChart = new Chart(
  document.getElementById("dailyDeviationChart"),
  {
    type: "line",
    data: {
      labels: labels,
      datasets: [
        {
          label: "Abweichung (°C)",
          data: deviation,
          borderWidth: 2,
          pointRadius: 0,
          fill: "origin",

          // Linienfarbe je Segment
          segment: {
            borderColor: ctx =>
              ctx.p0.parsed.y >= 0 ? "red" : "blue",
            backgroundColor: ctx =>
              ctx.p0.parsed.y >= 0
                ? "rgba(255,0,0,0.25)"
                : "rgba(0,150,255,0.25)"
          }
        },

        {
          label: "0 Linie",
          data: new Array(deviation.length).fill(0),
          borderColor: "black",
          borderDash: [6,6],
          pointRadius: 0,
          fill: false
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          title: {
            display: true,
            text: "Abweichung (°C)"
          }
        }
      }
    }
  }
);

}

document.getElementById("yearSelect").addEventListener("change",updateDaily);
document.getElementById("rangeSelect").addEventListener("change",updateDaily);

</script>

</body>
</html>
