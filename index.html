<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Climate Dashboard Deutschland</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>

<style>
body{
  font-family:Arial,sans-serif;
  padding:30px;
  background:#f4f6f8;
}

.tabs{
  display:flex;
  gap:20px;
  margin-bottom:30px;
}

.tab-button{
  padding:10px 20px;
  cursor:pointer;
  background:#ddd;
  border:none;
  border-radius:6px;
  font-weight:bold;
}

.tab-button.active{
  background:#444;
  color:white;
}

.tab-content{ display:none; }
.tab-content.active{ display:block; }

.chart-container{
  max-width:1400px;
  height:450px;
  margin:30px auto;
  background:white;
  padding:20px;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  background:white;
}

th,td{
  padding:8px;
  border:1px solid #ccc;
  text-align:center;
}
</style>
</head>
<body>

<h1>Climate Dashboard Deutschland</h1>

<div class="tabs">
  <button class="tab-button active" onclick="switchTab('monthly')">Monatswerte</button>
  <button class="tab-button" onclick="switchTab('daily')">Tageshöchstwerte</button>
  <button class="tab-button" onclick="switchTab('extremes')">Kenntage</button>
</div>

<div id="monthly" class="tab-content active">
  <p>Monatsdashboard bleibt hier wie zuvor integriert.</p>
</div>

<div id="daily" class="tab-content">
  <p>Tagesdashboard bleibt hier wie zuvor integriert.</p>
</div>

<!-- ================= KENNTAGE ================= -->

<div id="extremes" class="tab-content">

<h2>Kenntage (auf Basis Tageshöchstwerte)</h2>

<div class="chart-container">
  <canvas id="yearlyExtremeChart"></canvas>
</div>

<div class="chart-container">
  <canvas id="monthlyExtremeChart"></canvas>
</div>

<div class="chart-container">
  <canvas id="seasonExtremeChart"></canvas>
</div>

<h3>Top 30 heißeste Tage seit 1881</h3>
<table id="topHotDaysTable">
<thead>
<tr>
  <th>Rang</th>
  <th>Datum</th>
  <th>Temperatur (°C)</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<script>

// Tab Switch
function switchTab(tab){
  document.querySelectorAll(".tab-button").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
  document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add("active");
  document.getElementById(tab).classList.add("active");
}

let dailyData=[];

fetch("daily_tmax_1881_2026.json")
.then(res=>res.json())
.then(data=>{
  dailyData=data;
  buildExtremeCharts();
});

// ================= KENNTAGE =================

function buildExtremeCharts(){

  const years=[...new Set(dailyData.map(d=>d.date.substring(0,4)))];

  let yearlyCounts={
    summer:{},
    hot:{},
    veryHot:{}
  };

  years.forEach(y=>{
    yearlyCounts.summer[y]=0;
    yearlyCounts.hot[y]=0;
    yearlyCounts.veryHot[y]=0;
  });

  dailyData.forEach(d=>{
    const y=d.date.substring(0,4);
    const t=d.tmax;

    if(t>=25) yearlyCounts.summer[y]++;
    if(t>=30) yearlyCounts.hot[y]++;
    if(t>=35) yearlyCounts.veryHot[y]++;
  });

  // ===== Jahresdiagramm =====

  new Chart(document.getElementById("yearlyExtremeChart"),{
    type:"bar",
    data:{
      labels:years,
      datasets:[
        {label:"Sommertage (≥25°C)", data:years.map(y=>yearlyCounts.summer[y]), backgroundColor:"orange"},
        {label:"Hitzetage (≥30°C)", data:years.map(y=>yearlyCounts.hot[y]), backgroundColor:"red"},
        {label:"Sehr heiße Tage (≥35°C)", data:years.map(y=>yearlyCounts.veryHot[y]), backgroundColor:"darkred"}
      ]
    },
    options:{responsive:true,maintainAspectRatio:false}
  });

  // ===== Monatsdurchschnitt =====

  let monthNames=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];
  let monthCounts=Array(12).fill(0);

  dailyData.forEach(d=>{
    const m=parseInt(d.date.substring(5,7))-1;
    if(d.tmax>=25) monthCounts[m]++;
  });

  new Chart(document.getElementById("monthlyExtremeChart"),{
    type:"bar",
    data:{
      labels:monthNames,
      datasets:[
        {label:"Sommertage (alle Jahre)", data:monthCounts, backgroundColor:"orange"}
      ]
    },
    options:{responsive:true,maintainAspectRatio:false}
  });

  // ===== Jahreszeiten =====

  let seasonCounts={
    winter:0,
    spring:0,
    summer:0,
    autumn:0
  };

  dailyData.forEach(d=>{
    const m=d.date.substring(5,7);
    if(["12","01","02"].includes(m) && d.tmax>=25) seasonCounts.winter++;
    if(["03","04","05"].includes(m) && d.tmax>=25) seasonCounts.spring++;
    if(["06","07","08"].includes(m) && d.tmax>=25) seasonCounts.summer++;
    if(["09","10","11"].includes(m) && d.tmax>=25) seasonCounts.autumn++;
  });

  new Chart(document.getElementById("seasonExtremeChart"),{
    type:"bar",
    data:{
      labels:["Winter","Frühling","Sommer","Herbst"],
      datasets:[
        {label:"Sommertage (alle Jahre)", 
         data:[
           seasonCounts.winter,
           seasonCounts.spring,
           seasonCounts.summer,
           seasonCounts.autumn
         ],
         backgroundColor:"orange"}
      ]
    },
    options:{responsive:true,maintainAspectRatio:false}
  });

  // ===== Top 30 heißeste Tage =====

  const top30=[...dailyData]
    .sort((a,b)=>b.tmax-a.tmax)
    .slice(0,30);

  const tbody=document.querySelector("#topHotDaysTable tbody");

  top30.forEach((d,i)=>{
    tbody.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${d.date}</td>
        <td>${d.tmax.toFixed(1)}</td>
      </tr>
    `;
  });

}

</script>

</body>
</html>
